<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–±–æ—Ä–∞ –∫–∞–±–µ–ª—è - DKC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s;
        }

        body.dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        body.dark-theme .container {
            background: #2d2d44;
            color: #e0e0e0;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        body.dark-theme .header {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #667eea;
            font-size: 24px;
        }

        .header-title h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header-title p {
            font-size: 14px;
            opacity: 0.9;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .stats-badge {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        .tabs {
            display: flex;
            background: #2c3e50;
        }

        body.dark-theme .tabs {
            background: #1a1a2e;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            border: none;
            background: transparent;
            font-size: 16px;
        }

        .tab:hover {
            background: #34495e;
        }

        body.dark-theme .tab:hover {
            background: #0f3460;
        }

        .tab.active {
            background: white;
            color: #2c3e50;
        }

        body.dark-theme .tab.active {
            background: #2d2d44;
            color: #e0e0e0;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 28px;
        }

        body.dark-theme h2 {
            color: #e0e0e0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        body.dark-theme label {
            color: #b0b0b0;
        }

        input[type="text"],
        input[type="number"],
        input[type="url"],
        input[type="file"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        body.dark-theme input,
        body.dark-theme select {
            background: #1a1a2e;
            color: #e0e0e0;
            border-color: #444;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
            display: block;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        body.dark-theme th {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #ddd;
            font-size: 13px;
        }

        body.dark-theme td {
            border-color: #444;
        }

        tr:hover {
            background: #f8f9fa;
        }

        body.dark-theme tr:hover {
            background: #1a1a2e;
        }

        .weight-high {
            color: #e74c3c;
            font-weight: bold;
        }

        .weight-medium {
            color: #f39c12;
            font-weight: bold;
        }

        .weight-low {
            color: #27ae60;
            font-weight: bold;
        }

        .search-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        body.dark-theme .search-section {
            background: #1a1a2e;
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .admin-form {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        body.dark-theme .admin-form {
            background: #1a1a2e;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 25px 0 15px 0;
            font-size: 18px;
            font-weight: 600;
        }

        body.dark-theme .section-header {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }

        .edit-btn, .delete-btn {
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
            font-size: 12px;
        }

        .edit-btn {
            background: #3498db;
        }

        .delete-btn {
            background: #e74c3c;
        }

        .save-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .save-buttons .btn {
            width: 100%;
            margin: 5px 0;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 18px;
        }

        @media print {
            body {
                background: white;
            }
            .tabs, .header-controls, .btn, .search-section {
                display: none !important;
            }
            .container {
                box-shadow: none;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo">DKC</div>
                <div class="header-title">
                    <h1>–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–±–æ—Ä–∞ –∫–∞–±–µ–ª—è</h1>
                    <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
                </div>
            </div>
            <div class="header-controls">
                <div class="stats-badge">
                    üìä –ö–∞–±–µ–ª–µ–π –≤ –±–∞–∑–µ: <strong id="totalCables">0</strong>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåì</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">üîç –ü–æ–¥–±–æ—Ä –∫–∞–±–µ–ª—è</button>
            <button class="tab" onclick="switchTab(1)">‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
            <button class="tab" onclick="switchTab(2)">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ 1: –ü–æ–¥–±–æ—Ä –∫–∞–±–µ–ª—è -->
        <div class="tab-content active">
            <h2>–ü–æ–¥–±–æ—Ä –∫–∞–±–µ–ª—è –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</h2>
            
            <div class="search-section">
                <div class="search-grid">
                    <div class="form-group">
                        <label>–¢–∏–ø –∫–∞–±–µ–ª—è:</label>
                        <select id="searchType">
                            <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–ß–∏—Å–ª–æ –∂–∏–ª –∏ —Å–µ—á–µ–Ω–∏–µ:</label>
                        <select id="searchSection">
                            <option value="">–í—Å–µ —Å–µ—á–µ–Ω–∏—è</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>–ù–∞—Ä—É–∂–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <select id="searchDiameter">
                            <option value="">–í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" onclick="searchCables()">–ù–∞–π—Ç–∏ –∫–∞–±–µ–ª—å</button>
                <button class="btn btn-success" onclick="exportToExcel()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
                <button class="btn btn-info" onclick="printResults()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
                <button class="btn" onclick="resetSearch()" style="background: #95a5a6;">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>

            <div id="searchResults"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ 2: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
        <div class="tab-content">
            <h2>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –∫–∞–±–µ–ª–∏</h2>
            <div id="favoritesList"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ 3: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ -->
        <div class="tab-content">
            <h2>–î–æ–±–∞–≤–∏—Ç—å/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–±–µ–ª—å</h2>
            
            <div class="admin-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>–¢–∏–ø –∫–∞–±–µ–ª—è:</label>
                        <input type="text" id="cableType" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–í–í–ì–Ω–≥-LS">
                    </div>
                    
                    <div class="form-group">
                        <label>–ß–∏—Å–ª–æ –∂–∏–ª –∏ –Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ–µ —Å–µ—á–µ–Ω–∏–µ (–º–º¬≤):</label>
                        <input type="text" id="cableSection" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 4√ó0,75">
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–∞—Ä—É–∂–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä –∫–∞–±–µ–ª—è (–º–º):</label>
                        <input type="number" id="cableDiameter" placeholder="11,0" step="0.1">
                    </div>
                </div>

                <div class="section-header">–ó–∞—â–∏—Ç–∞ –∫–∞–±–µ–ª—è –ú–† (–ú–µ—Ç–∞–ª–ª–æ—Ä—É–∫–∞–≤)</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <input type="number" id="mrInnerDiameter" placeholder="12.5" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–∞—Ä—É–∂–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <input type="number" id="mrOuterDiameter" placeholder="16.2" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>–ö–æ–¥ (DKC):</label>
                        <input type="text" id="mrCode" placeholder="6016-24 –ë–ò–†">
                    </div>
                    
                    <div class="form-group">
                        <label>–í–µ—Å (–∫–≥/–º):</label>
                        <input type="number" id="mrWeightKgM" placeholder="0.085" step="0.001">
                    </div>
                    
                    <div class="form-group">
                        <label>–í–µ—Å (–∫–≥/–∫–º):</label>
                        <input type="number" id="mrWeightKgKm" placeholder="85" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <input type="number" id="mrNominalDiameter" placeholder="16" step="0.1">
                    </div>
                </div>

                <div class="section-header">–ó–∞—â–∏—Ç–∞ –∫–∞–±–µ–ª—è –ì–§ (–ì–æ—Ñ—Ä–∞)</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <input type="number" id="gfInnerDiameter" placeholder="11.7" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–∞—Ä—É–∂–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <input type="number" id="gfOuterDiameter" placeholder="15.8" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>–ö–æ–¥ (DKC):</label>
                        <input type="text" id="gfCode" placeholder="01922">
                    </div>
                    
                    <div class="form-group">
                        <label>–í–µ—Å (–∫–≥/–º):</label>
                        <input type="number" id="gfWeightKgM" placeholder="0.045" step="0.001">
                    </div>
                    
                    <div class="form-group">
                        <label>–í–µ—Å (–∫–≥/–∫–º):</label>
                        <input type="number" id="gfWeightKgKm" placeholder="45" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <input type="number" id="gfNominalDiameter" placeholder="16" step="0.1">
                    </div>
                </div>

                <div class="section-header">–ó–∞—â–∏—Ç–∞ –∫–∞–±–µ–ª—è –¢–† (–¢—Ä—É–±–∞)</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <input type="number" id="trInnerDiameter" placeholder="13.8" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–∞—Ä—É–∂–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <input type="number" id="trOuterDiameter" placeholder="16" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>–ö–æ–¥ (DKC):</label>
                        <input type="text" id="trCode" placeholder="6016-24 L3">
                    </div>
                    
                    <div class="form-group">
                        <label>–í–µ—Å (–∫–≥/–º):</label>
                        <input type="number" id="trWeightKgM" placeholder="0.095" step="0.001">
                    </div>
                    
                    <div class="form-group">
                        <label>–í–µ—Å (–∫–≥/–∫–º):</label>
                        <input type="number" id="trWeightKgKm" placeholder="95" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä (–º–º):</label>
                        <input type="number" id="trNominalDiameter" placeholder="16" step="0.1">
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn" onclick="saveCable()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–±–µ–ª—å</button>
                    <button class="btn" onclick="cancelEdit()" style="background: #95a5a6;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>

            <h2>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
            <div class="admin-form">
                <div class="save-buttons">
                    <button class="btn" onclick="saveAllDataToFile()" style="background: #9b59b6;">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª
                    </button>
                    <button class="btn" onclick="loadDataFromFile()" style="background: #3498db;">
                        üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞
                    </button>
                    <button class="btn" onclick="exportToJSON()" style="background: #1abc9c;">
                        üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
                    </button>
                    <button class="btn" onclick="importFromJSON()" style="background: #e67e22;">
                        üì• –ò–º–ø–æ—Ä—Ç –∏–∑ JSON
                    </button>
                </div>
            </div>

            <h2>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel</h2>
            <div class="admin-form">
                <div class="form-group">
                    <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å Excel —Ñ–∞–π–ª (.xlsx, .xls, .csv):</label>
                    <input type="file" id="importFile" accept=".xlsx,.xls,.csv">
                </div>
                <button class="btn btn-success" onclick="importFromExcel()">üì§ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>

            <h2>–°–ø–∏—Å–æ–∫ –∫–∞–±–µ–ª–µ–π</h2>
            <div id="cablesList" style="overflow-x: auto;"></div>
        </div>
    </div>

    <div style="text-align: center; padding: 20px; color: white; font-size: 14px; margin-top: 20px;">
        <p style="margin: 0;">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: <strong>–ù–∏–∫–∏—Ç–∏–Ω –ê.–Æ.</strong></p>
        <p style="margin: 5px 0 0 0; opacity: 0.8;">–ü—Ä–æ–µ–∫—Ç: –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let cables = [];
        let editingIndex = -1;
        let favorites = [];

        window.onload = function() {
            loadCables();
            loadFavorites();
            
            if (cables.length === 0) {
                cables = [];
            }
            
            displayCables();
            updateSearchFilters();
            updateStats();
        };

        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            tabs[index].classList.add('active');
            contents[index].classList.add('active');
            
            if (index === 1) displayFavorites();
            if (index === 2) displayCables();
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            localStorage.setItem('darkTheme', document.body.classList.contains('dark-theme'));
        }

        if (localStorage.getItem('darkTheme') === 'true') {
            document.body.classList.add('dark-theme');
        }

        function saveCable() {
            const cable = {
                type: document.getElementById('cableType').value,
                section: document.getElementById('cableSection').value,
                diameter: parseFloat(document.getElementById('cableDiameter').value) || 0,
                mr: {
                    innerDiameter: parseFloat(document.getElementById('mrInnerDiameter').value) || 0,
                    outerDiameter: parseFloat(document.getElementById('mrOuterDiameter').value) || 0,
                    code: document.getElementById('mrCode').value,
                    weightKgM: parseFloat(document.getElementById('mrWeightKgM').value) || 0,
                    weightKgKm: parseFloat(document.getElementById('mrWeightKgKm').value) || 0,
                    nominalDiameter: parseFloat(document.getElementById('mrNominalDiameter').value) || 0
                },
                gf: {
                    innerDiameter: parseFloat(document.getElementById('gfInnerDiameter').value) || 0,
                    outerDiameter: parseFloat(document.getElementById('gfOuterDiameter').value) || 0,
                    code: document.getElementById('gfCode').value,
                    weightKgM: parseFloat(document.getElementById('gfWeightKgM').value) || 0,
                    weightKgKm: parseFloat(document.getElementById('gfWeightKgKm').value) || 0,
                    nominalDiameter: parseFloat(document.getElementById('gfNominalDiameter').value) || 0
                },
                tr: {
                    innerDiameter: parseFloat(document.getElementById('trInnerDiameter').value) || 0,
                    outerDiameter: parseFloat(document.getElementById('trOuterDiameter').value) || 0,
                    code: document.getElementById('trCode').value,
                    weightKgM: parseFloat(document.getElementById('trWeightKgM').value) || 0,
                    weightKgKm: parseFloat(document.getElementById('trWeightKgKm').value) || 0,
                    nominalDiameter: parseFloat(document.getElementById('trNominalDiameter').value) || 0
                }
            };

            if (!cable.type || !cable.section) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–∏–ø –∫–∞–±–µ–ª—è –∏ —Å–µ—á–µ–Ω–∏–µ!');
                return;
            }

            if (editingIndex >= 0) {
                cables[editingIndex] = cable;
                editingIndex = -1;
            } else {
                cables.push(cable);
            }

            saveCables();
            displayCables();
            updateSearchFilters();
            updateStats();
            clearForm();
            alert('–ö–∞–±–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
        }

        function editCable(index) {
            const cable = cables[index];
            editingIndex = index;
            
            document.getElementById('cableType').value = cable.type;
            document.getElementById('cableSection').value = cable.section;
            document.getElementById('cableDiameter').value = cable.diameter;
            
            // –ú–†
            document.getElementById('mrInnerDiameter').value = cable.mr?.innerDiameter || '';
            document.getElementById('mrOuterDiameter').value = cable.mr?.outerDiameter || '';
            document.getElementById('mrCode').value = cable.mr?.code || '';
            document.getElementById('mrWeightKgM').value = cable.mr?.weightKgM || '';
            document.getElementById('mrWeightKgKm').value = cable.mr?.weightKgKm || '';
            document.getElementById('mrNominalDiameter').value = cable.mr?.nominalDiameter || '';
            
            // –ì–§
            document.getElementById('gfInnerDiameter').value = cable.gf?.innerDiameter || '';
            document.getElementById('gfOuterDiameter').value = cable.gf?.outerDiameter || '';
            document.getElementById('gfCode').value = cable.gf?.code || '';
            document.getElementById('gfWeightKgM').value = cable.gf?.weightKgM || '';
            document.getElementById('gfWeightKgKm').value = cable.gf?.weightKgKm || '';
            document.getElementById('gfNominalDiameter').value = cable.gf?.nominalDiameter || '';
            
            // –¢–†
            document.getElementById('trInnerDiameter').value = cable.tr?.innerDiameter || '';
            document.getElementById('trOuterDiameter').value = cable.tr?.outerDiameter || '';
            document.getElementById('trCode').value = cable.tr?.code || '';
            document.getElementById('trWeightKgM').value = cable.tr?.weightKgM || '';
            document.getElementById('trWeightKgKm').value = cable.tr?.weightKgKm || '';
            document.getElementById('trNominalDiameter').value = cable.tr?.nominalDiameter || '';
            
            switchTab(2);
            window.scrollTo(0, 0);
        }

        function deleteCable(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–∞–±–µ–ª—å?')) {
                cables.splice(index, 1);
                saveCables();
                displayCables();
                updateSearchFilters();
                updateStats();
            }
        }

        function cancelEdit() {
            editingIndex = -1;
            clearForm();
        }

        function clearForm() {
            document.getElementById('cableType').value = '';
            document.getElementById('cableSection').value = '';
            document.getElementById('cableDiameter').value = '';
            
            ['mr', 'gf', 'tr'].forEach(prefix => {
                document.getElementById(prefix + 'InnerDiameter').value = '';
                document.getElementById(prefix + 'OuterDiameter').value = '';
                document.getElementById(prefix + 'Code').value = '';
                document.getElementById(prefix + 'WeightKgM').value = '';
                document.getElementById(prefix + 'WeightKgKm').value = '';
                document.getElementById(prefix + 'NominalDiameter').value = '';
            });
        }

        function displayCables() {
            const list = document.getElementById('cablesList');
            
            if (cables.length === 0) {
                list.innerHTML = '<div class="no-results">–ö–∞–±–µ–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>';
                return;
            }

            let html = '<table><thead><tr>';
            html += '<th rowspan="2">–¢–∏–ø –∫–∞–±–µ–ª—è</th>';
            html += '<th rowspan="2">–ß–∏—Å–ª–æ –∂–∏–ª –∏ —Å–µ—á–µ–Ω–∏–µ</th>';
            html += '<th rowspan="2">–ù–∞—Ä—É–∂–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä –∫–∞–±–µ–ª—è (–º–º)</th>';
            html += '<th colspan="6">–ú–† (–ú–µ—Ç–∞–ª–ª–æ—Ä—É–∫–∞–≤)</th>';
            html += '<th colspan="6">–ì–§ (–ì–æ—Ñ—Ä–∞)</th>';
            html += '<th colspan="6">–¢–† (–¢—Ä—É–±–∞)</th>';
            html += '<th rowspan="2">–î–µ–π—Å—Ç–≤–∏—è</th>';
            html += '</tr><tr>';
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –ú–†, –ì–§, –¢–†
            for (let i = 0; i < 3; i++) {
                html += '<th>–í–Ω—É—Ç—Ä. √ò (–º–º)</th>';
                html += '<th>–ù–∞—Ä—É–∂. √ò (–º–º)</th>';
                html += '<th>–ö–æ–¥</th>';
                html += '<th>–í–µ—Å (–∫–≥/–º)</th>';
                html += '<th>–í–µ—Å (–∫–≥/–∫–º)</th>';
                html += '<th>–ù–æ–º–∏–Ω. √ò (–º–º)</th>';
            }
            
            html += '</tr></thead><tbody>';

            cables.forEach((cable, index) => {
                html += '<tr>';
                html += `<td>${cable.type}</td>`;
                html += `<td>${cable.section}</td>`;
                html += `<td>${cable.diameter}</td>`;
                
                // –ú–†
                html += `<td>${cable.mr?.innerDiameter || '‚Äî'}</td>`;
                html += `<td>${cable.mr?.outerDiameter || '‚Äî'}</td>`;
                html += `<td>${cable.mr?.code || '‚Äî'}</td>`;
                html += `<td>${cable.mr?.weightKgM || '‚Äî'}</td>`;
                html += `<td>${cable.mr?.weightKgKm || '‚Äî'}</td>`;
                html += `<td>${cable.mr?.nominalDiameter || '‚Äî'}</td>`;
                
                // –ì–§
                html += `<td>${cable.gf?.innerDiameter || '‚Äî'}</td>`;
                html += `<td>${cable.gf?.outerDiameter || '‚Äî'}</td>`;
                html += `<td>${cable.gf?.code || '‚Äî'}</td>`;
                html += `<td>${cable.gf?.weightKgM || '‚Äî'}</td>`;
                html += `<td>${cable.gf?.weightKgKm || '‚Äî'}</td>`;
                html += `<td>${cable.gf?.nominalDiameter || '‚Äî'}</td>`;
                
                // –¢–†
                html += `<td>${cable.tr?.innerDiameter || '‚Äî'}</td>`;
                html += `<td>${cable.tr?.outerDiameter || '‚Äî'}</td>`;
                html += `<td>${cable.tr?.code || '‚Äî'}</td>`;
                html += `<td>${cable.tr?.weightKgM || '‚Äî'}</td>`;
                html += `<td>${cable.tr?.weightKgKm || '‚Äî'}</td>`;
                html += `<td>${cable.tr?.nominalDiameter || '‚Äî'}</td>`;
                
                html += `<td>
                    <button class="edit-btn" onclick="editCable(${index})">‚úèÔ∏è</button>
                    <button class="delete-btn" onclick="deleteCable(${index})">üóëÔ∏è</button>
                </td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            list.innerHTML = html;
        }

        function updateSearchFilters() {
            const typeSelect = document.getElementById('searchType');
            const sectionSelect = document.getElementById('searchSection');
            const diameterSelect = document.getElementById('searchDiameter');
            
            const types = [...new Set(cables.map(c => c.type))];
            const sections = [...new Set(cables.map(c => c.section))];
            const diameters = [...new Set(cables.map(c => c.diameter))].sort((a, b) => a - b);
            
            typeSelect.innerHTML = '<option value="">–í—Å–µ —Ç–∏–ø—ã</option>';
            types.forEach(type => {
                typeSelect.innerHTML += `<option value="${type}">${type}</option>`;
            });
            
            sectionSelect.innerHTML = '<option value="">–í—Å–µ —Å–µ—á–µ–Ω–∏—è</option>';
            sections.forEach(section => {
                sectionSelect.innerHTML += `<option value="${section}">${section}</option>`;
            });

            diameterSelect.innerHTML = '<option value="">–í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è</option>';
            diameters.forEach(diameter => {
                diameterSelect.innerHTML += `<option value="${diameter}">${diameter}</option>`;
            });
        }

        function searchCables() {
            const type = document.getElementById('searchType').value;
            const section = document.getElementById('searchSection').value;
            const diameter = document.getElementById('searchDiameter').value;
            
            let results = cables;
            
            if (type) results = results.filter(c => c.type === type);
            if (section) results = results.filter(c => c.section === section);
            if (diameter) results = results.filter(c => c.diameter == diameter);
            
            displaySearchResults(results);
        }

        function resetSearch() {
            document.getElementById('searchType').value = '';
            document.getElementById('searchSection').value = '';
            document.getElementById('searchDiameter').value = '';
            document.getElementById('searchResults').innerHTML = '';
        }

        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            
            if (results.length === 0) {
                container.innerHTML = '<div class="no-results">–ö–∞–±–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.</div>';
                return;
            }
            
            let html = '<table><thead><tr>';
            html += '<th>–¢–∏–ø –∫–∞–±–µ–ª—è</th>';
            html += '<th>–°–µ—á–µ–Ω–∏–µ</th>';
            html += '<th>–ù–∞—Ä—É–∂–Ω—ã–π √ò (–º–º)</th>';
            html += '<th colspan="3">–ú–†</th>';
            html += '<th colspan="3">–ì–§</th>';
            html += '<th colspan="3">–¢–†</th>';
            html += '<th>‚≠ê</th>';
            html += '</tr><tr>';
            html += '<th colspan="3"></th>';
            for (let i = 0; i < 3; i++) {
                html += '<th>–ö–æ–¥</th><th>–ù–æ–º–∏–Ω. √ò</th><th>–í–µ—Å (–∫–≥/–∫–º)</th>';
            }
            html += '<th></th>';
            html += '</tr></thead><tbody>';
            
            results.forEach((cable, index) => {
                const isFavorite = favorites.some(f => 
                    f.type === cable.type && f.section === cable.section
                );
                
                html += '<tr>';
                html += `<td><strong>${cable.type}</strong></td>`;
                html += `<td>${cable.section}</td>`;
                html += `<td>${cable.diameter}</td>`;
                
                // –ú–†
                html += `<td>${cable.mr?.code || '‚Äî'}</td>`;
                html += `<td>${cable.mr?.nominalDiameter || '‚Äî'}</td>`;
                html += `<td>${cable.mr?.weightKgKm || '‚Äî'}</td>`;
                
                // –ì–§
                html += `<td>${cable.gf?.code || '‚Äî'}</td>`;
                html += `<td>${cable.gf?.nominalDiameter || '‚Äî'}</td>`;
                html += `<td>${cable.gf?.weightKgKm || '‚Äî'}</td>`;
                
                // –¢–†
                html += `<td>${cable.tr?.code || '‚Äî'}</td>`;
                html += `<td>${cable.tr?.nominalDiameter || '‚Äî'}</td>`;
                html += `<td>${cable.tr?.weightKgKm || '‚Äî'}</td>`;
                
                html += `<td>
                    <button class="favorite-btn" onclick="toggleFavorite(${cables.indexOf(cable)})" style="background: none; border: none; cursor: pointer; font-size: 20px;">
                        ${isFavorite ? '‚≠ê' : '‚òÜ'}
                    </button>
                </td>`;
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function toggleFavorite(index) {
            const cable = cables[index];
            const favIndex = favorites.findIndex(f => 
                f.type === cable.type && f.section === cable.section
            );
            
            if (favIndex >= 0) {
                favorites.splice(favIndex, 1);
            } else {
                favorites.push(cable);
            }
            
            saveFavorites();
            searchCables();
        }

        function displayFavorites() {
            const container = document.getElementById('favoritesList');
            
            if (favorites.length === 0) {
                container.innerHTML = '<div class="no-results">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞–±–µ–ª–µ–π</div>';
                return;
            }
            
            displaySearchResults(favorites);
            container.innerHTML = document.getElementById('searchResults').innerHTML;
        }

        function saveAllDataToFile() {
            const allData = {
                cables: cables,
                favorites: favorites,
                timestamp: new Date().toLocaleString('ru-RU'),
                version: "2.0"
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: "application/json" });
            
            const link = document.createElement("a");
            link.href = URL.createObjectURL(dataBlob);
            link.download = `cable_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª!');
        }

        function loadDataFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (data.cables) cables = data.cables;
                        if (data.favorites) favorites = data.favorites;
                        
                        saveCables();
                        saveFavorites();
                        
                        displayCables();
                        updateSearchFilters();
                        updateStats();
                        
                        alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞!');
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞! –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function exportToJSON() {
            saveAllDataToFile();
        }

        function importFromJSON() {
            loadDataFromFile();
        }

        function exportToExcel() {
            if (cables.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!');
                return;
            }

            const data = cables.map(cable => ({
                '–¢–∏–ø –∫–∞–±–µ–ª—è': cable.type,
                '–ß–∏—Å–ª–æ –∂–∏–ª –∏ —Å–µ—á–µ–Ω–∏–µ': cable.section,
                '–ù–∞—Ä—É–∂–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä –∫–∞–±–µ–ª—è (–º–º)': cable.diameter,
                '–ú–† - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π √ò (–º–º)': cable.mr?.innerDiameter || '',
                '–ú–† - –ù–∞—Ä—É–∂–Ω—ã–π √ò (–º–º)': cable.mr?.outerDiameter || '',
                '–ú–† - –ö–æ–¥': cable.mr?.code || '',
                '–ú–† - –í–µ—Å (–∫–≥/–º)': cable.mr?.weightKgM || '',
                '–ú–† - –í–µ—Å (–∫–≥/–∫–º)': cable.mr?.weightKgKm || '',
                '–ú–† - –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π √ò (–º–º)': cable.mr?.nominalDiameter || '',
                '–ì–§ - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π √ò (–º–º)': cable.gf?.innerDiameter || '',
                '–ì–§ - –ù–∞—Ä—É–∂–Ω—ã–π √ò (–º–º)': cable.gf?.outerDiameter || '',
                '–ì–§ - –ö–æ–¥': cable.gf?.code || '',
                '–ì–§ - –í–µ—Å (–∫–≥/–º)': cable.gf?.weightKgM || '',
                '–ì–§ - –í–µ—Å (–∫–≥/–∫–º)': cable.gf?.weightKgKm || '',
                '–ì–§ - –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π √ò (–º–º)': cable.gf?.nominalDiameter || '',
                '–¢–† - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π √ò (–º–º)': cable.tr?.innerDiameter || '',
                '–¢–† - –ù–∞—Ä—É–∂–Ω—ã–π √ò (–º–º)': cable.tr?.outerDiameter || '',
                '–¢–† - –ö–æ–¥': cable.tr?.code || '',
                '–¢–† - –í–µ—Å (–∫–≥/–º)': cable.tr?.weightKgM || '',
                '–¢–† - –í–µ—Å (–∫–≥/–∫–º)': cable.tr?.weightKgKm || '',
                '–¢–† - –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π √ò (–º–º)': cable.tr?.nominalDiameter || ''
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '–ö–∞–±–µ–ª–∏');
            
            const fileName = `–ö–∞–±–µ–ª–∏_DKC_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        function importFromExcel() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞!');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    let imported = 0;
                    jsonData.forEach(row => {
                        const cable = {
                            type: row['–¢–∏–ø –∫–∞–±–µ–ª—è'] || '',
                            section: row['–ß–∏—Å–ª–æ –∂–∏–ª –∏ —Å–µ—á–µ–Ω–∏–µ'] || '',
                            diameter: parseFloat(row['–ù–∞—Ä—É–∂–Ω—ã–π –¥–∏–∞–º–µ—Ç—Ä –∫–∞–±–µ–ª—è (–º–º)']) || 0,
                            mr: {
                                innerDiameter: parseFloat(row['–ú–† - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π √ò (–º–º)']) || 0,
                                outerDiameter: parseFloat(row['–ú–† - –ù–∞—Ä—É–∂–Ω—ã–π √ò (–º–º)']) || 0,
                                code: row['–ú–† - –ö–æ–¥'] || '',
                                weightKgM: parseFloat(row['–ú–† - –í–µ—Å (–∫–≥/–º)']) || 0,
                                weightKgKm: parseFloat(row['–ú–† - –í–µ—Å (–∫–≥/–∫–º)']) || 0,
                                nominalDiameter: parseFloat(row['–ú–† - –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π √ò (–º–º)']) || 0
                            },
                            gf: {
                                innerDiameter: parseFloat(row['–ì–§ - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π √ò (–º–º)']) || 0,
                                outerDiameter: parseFloat(row['–ì–§ - –ù–∞—Ä—É–∂–Ω—ã–π √ò (–º–º)']) || 0,
                                code: row['–ì–§ - –ö–æ–¥'] || '',
                                weightKgM: parseFloat(row['–ì–§ - –í–µ—Å (–∫–≥/–º)']) || 0,
                                weightKgKm: parseFloat(row['–ì–§ - –í–µ—Å (–∫–≥/–∫–º)']) || 0,
                                nominalDiameter: parseFloat(row['–ì–§ - –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π √ò (–º–º)']) || 0
                            },
                            tr: {
                                innerDiameter: parseFloat(row['–¢–† - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π √ò (–º–º)']) || 0,
                                outerDiameter: parseFloat(row['–¢–† - –ù–∞—Ä—É–∂–Ω—ã–π √ò (–º–º)']) || 0,
                                code: row['–¢–† - –ö–æ–¥'] || '',
                                weightKgM: parseFloat(row['–¢–† - –í–µ—Å (–∫–≥/–º)']) || 0,
                                weightKgKm: parseFloat(row['–¢–† - –í–µ—Å (–∫–≥/–∫–º)']) || 0,
                                nominalDiameter: parseFloat(row['–¢–† - –ù–æ–º–∏–Ω–∞–ª—å–Ω—ã–π √ò (–º–º)']) || 0
                            }
                        };
                        
                        if (cable.type && cable.section) {
                            cables.push(cable);
                            imported++;
                        }
                    });
                    
                    saveCables();
                    displayCables();
                    updateSearchFilters();
                    updateStats();
                    
                    alert(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∫–∞–±–µ–ª–µ–π: ${imported}`);
                    fileInput.value = '';
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.');
                    console.error(error);
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        function printResults() {
            window.print();
        }

        function updateStats() {
            document.getElementById('totalCables').textContent = cables.length;
        }

        function saveCables() {
            localStorage.setItem('cables', JSON.stringify(cables));
        }

        function loadCables() {
            const saved = localStorage.getItem('cables');
            if (saved) cables = JSON.parse(saved);
        }

        function saveFavorites() {
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        function loadFavorites() {
            const saved = localStorage.getItem('favorites');
            if (saved) favorites = JSON.parse(saved);
        }
    </script>
</body>
</html>
